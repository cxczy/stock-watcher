# è·¯ç”±é”™è¯¯ä¿®å¤è¯´æ˜

## ğŸ› é”™è¯¯æè¿°

ç”¨æˆ·é‡åˆ°React Routeré”™è¯¯ï¼š
```
Error handled by React Router default ErrorBoundary: TypeError: Cannot read properties of undefined (reading 'map')
```

## ğŸ” é—®é¢˜åˆ†æ

### 1. å¯èƒ½çš„åŸå› 
- **æ•°æ®æœªå®šä¹‰**ï¼šæŸä¸ªæ•°ç»„æˆ–å¯¹è±¡ä¸ºundefinedï¼Œä½†ä»£ç å°è¯•è°ƒç”¨.map()æ–¹æ³•
- **ç»„ä»¶åŠ è½½é—®é¢˜**ï¼šè·¯ç”±ç»„ä»¶åœ¨åŠ è½½æ—¶å‡ºç°é”™è¯¯
- **çŠ¶æ€ç®¡ç†é—®é¢˜**ï¼šJotaiçŠ¶æ€æœªæ­£ç¡®åˆå§‹åŒ–

### 2. å·²ä¿®å¤çš„é—®é¢˜

#### ä¿®å¤STOCK_POOLSæ•°æ®ç»“æ„
**é—®é¢˜**ï¼šSTOCK_POOLSç»“æ„ä¸æ­£ç¡®ï¼Œå¯¼è‡´.map()è°ƒç”¨å¤±è´¥

**ä¿®å¤å‰ï¼š**
```javascript
export const STOCK_POOLS = {
  'ä¸­è¯500': ZZ500_STOCKS,  // ç›´æ¥æ˜¯æ•°ç»„
  'ä¸­è¯1000': ZZ1000_STOCKS,
  'è‡ªé€‰ç»„åˆ': SELF_GROUP_STOCKS
};
```

**ä¿®å¤åï¼š**
```javascript
export const STOCK_POOLS = {
  'ä¸­è¯500': {
    name: 'ä¸­è¯500',
    stocks: ZZ500_STOCKS.map(code => ({ code, name: `è‚¡ç¥¨${code}` }))
  },
  'ä¸­è¯1000': {
    name: 'ä¸­è¯1000', 
    stocks: ZZ1000_STOCKS.map(code => ({ code, name: `è‚¡ç¥¨${code}` }))
  },
  'è‡ªé€‰ç»„åˆ': {
    name: 'è‡ªé€‰ç»„åˆ',
    stocks: SELF_GROUP_STOCKS.map(code => ({ code, name: `è‚¡ç¥¨${code}` }))
  }
};
```

#### æ·»åŠ é”™è¯¯è¾¹ç•Œ
**æ–°å¢**ï¼šErrorBoundaryç»„ä»¶æ¥æ•è·å’Œå¤„ç†è·¯ç”±é”™è¯¯

```javascript
// client/components/ErrorBoundary.jsx
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    console.error('ErrorBoundary caught an error:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div style={{ padding: 20 }}>
          <Alert
            message="é¡µé¢å‡ºç°é”™è¯¯"
            description={
              <div>
                <p>é”™è¯¯ä¿¡æ¯: {this.state.error?.message || 'æœªçŸ¥é”™è¯¯'}</p>
                <p>è¯·å°è¯•åˆ·æ–°é¡µé¢æˆ–è”ç³»ç®¡ç†å‘˜</p>
              </div>
            }
            type="error"
            showIcon
            action={
              <Button 
                size="small" 
                danger 
                onClick={() => window.location.reload()}
              >
                åˆ·æ–°é¡µé¢
              </Button>
            }
          />
        </div>
      );
    }

    return this.props.children;
  }
}
```

#### æ›´æ–°è·¯ç”±é…ç½®
**ä¿®å¤**ï¼šåœ¨è·¯ç”±é…ç½®ä¸­æ·»åŠ é”™è¯¯è¾¹ç•Œ

```javascript
export default function AppRouter() {
  const token = useAtomValue(tokenAtom);
  
  if (!token) {
    return <Auth />;
  }
  
  return (
    <ErrorBoundary>
      <RouterProvider router={router} />
    </ErrorBoundary>
  );
}
```

## âœ… ä¿®å¤å†…å®¹

### 1. æ•°æ®ç»“æ„ä¿®å¤
- **STOCK_POOLS**ï¼šä¿®å¤ä¸ºæ­£ç¡®çš„å¯¹è±¡ç»“æ„
- **è‚¡ç¥¨æ•°æ®**ï¼šç¡®ä¿æ¯ä¸ªè‚¡ç¥¨æ± éƒ½æœ‰æ­£ç¡®çš„stocksæ•°ç»„
- **ç±»å‹å®‰å…¨**ï¼šæ·»åŠ å¯é€‰é“¾æ“ä½œç¬¦é˜²æ­¢undefinedé”™è¯¯

### 2. é”™è¯¯å¤„ç†
- **é”™è¯¯è¾¹ç•Œ**ï¼šæ·»åŠ Reacté”™è¯¯è¾¹ç•Œç»„ä»¶
- **é”™è¯¯æ•è·**ï¼šæ•è·å¹¶æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
- **é”™è¯¯æ¢å¤**ï¼šæä¾›åˆ·æ–°é¡µé¢åŠŸèƒ½

### 3. è·¯ç”±ä¿æŠ¤
- **è®¤è¯æ£€æŸ¥**ï¼šç¡®ä¿ç”¨æˆ·å·²ç™»å½•
- **ç»„ä»¶åŠ è½½**ï¼šå®‰å…¨åŠ è½½è·¯ç”±ç»„ä»¶
- **çŠ¶æ€ç®¡ç†**ï¼šæ­£ç¡®åˆå§‹åŒ–JotaiçŠ¶æ€

## ğŸ”§ æµ‹è¯•æ–¹æ³•

### 1. è®¿é—®æµ‹è¯•è·¯ç”±
è®¿é—® `http://localhost:3000/test` æµ‹è¯•è·¯ç”±ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ

### 2. æ£€æŸ¥æ§åˆ¶å°
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### 3. åŠŸèƒ½æµ‹è¯•
- æµ‹è¯•å„ä¸ªè·¯ç”±é¡µé¢æ˜¯å¦æ­£å¸¸åŠ è½½
- æµ‹è¯•è‚¡ç¥¨æ± é€‰æ‹©åŠŸèƒ½
- æµ‹è¯•è‚¡ç¥¨é€‰æ‹©åŠŸèƒ½

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. æ•°æ®æœªå®šä¹‰
**ç—‡çŠ¶**ï¼šCannot read properties of undefined (reading 'map')
**è§£å†³**ï¼šæ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–ï¼Œæ·»åŠ å¯é€‰é“¾æ“ä½œç¬¦

### 2. ç»„ä»¶åŠ è½½å¤±è´¥
**ç—‡çŠ¶**ï¼šç»„ä»¶æ— æ³•æ­£å¸¸æ¸²æŸ“
**è§£å†³**ï¼šæ£€æŸ¥ç»„ä»¶å¯¼å…¥è·¯å¾„ï¼Œç¡®ä¿ç»„ä»¶å­˜åœ¨

### 3. çŠ¶æ€ç®¡ç†é—®é¢˜
**ç—‡çŠ¶**ï¼šçŠ¶æ€æœªæ­£ç¡®æ›´æ–°
**è§£å†³**ï¼šæ£€æŸ¥Jotai atomå®šä¹‰ï¼Œç¡®ä¿çŠ¶æ€æ­£ç¡®åˆå§‹åŒ–

## ğŸ“Š ä¿®å¤æ•ˆæœ

### 1. é”™è¯¯å¤„ç†
- **å‹å¥½æç¤º**ï¼šæ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- **é”™è¯¯æ¢å¤**ï¼šæä¾›åˆ·æ–°é¡µé¢åŠŸèƒ½
- **é”™è¯¯æ—¥å¿—**ï¼šåœ¨æ§åˆ¶å°è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯

### 2. æ•°æ®å®‰å…¨
- **ç±»å‹æ£€æŸ¥**ï¼šç¡®ä¿æ•°æ®ç±»å‹æ­£ç¡®
- **ç©ºå€¼å¤„ç†**ï¼šå¤„ç†undefinedå’Œnullå€¼
- **é»˜è®¤å€¼**ï¼šæä¾›åˆç†çš„é»˜è®¤å€¼

### 3. ç”¨æˆ·ä½“éªŒ
- **é”™è¯¯è¾¹ç•Œ**ï¼šé˜²æ­¢æ•´ä¸ªåº”ç”¨å´©æºƒ
- **é”™è¯¯æç¤º**ï¼šæ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- **æ¢å¤æœºåˆ¶**ï¼šå¿«é€Ÿæ¢å¤åº”ç”¨çŠ¶æ€

## ğŸš€ åç»­ä¼˜åŒ–

### 1. é”™è¯¯ç›‘æ§
```javascript
// æ·»åŠ é”™è¯¯ç›‘æ§
const errorHandler = (error, errorInfo) => {
  console.error('Application Error:', error, errorInfo);
  // å‘é€é”™è¯¯åˆ°ç›‘æ§æœåŠ¡
};
```

### 2. æ€§èƒ½ä¼˜åŒ–
```javascript
// æ‡’åŠ è½½ç»„ä»¶
const LazyComponent = React.lazy(() => import('./Component'));
```

### 3. çŠ¶æ€ç®¡ç†
```javascript
// æ·»åŠ çŠ¶æ€éªŒè¯
const validateState = (state) => {
  if (!state || typeof state !== 'object') {
    throw new Error('Invalid state');
  }
};
```

ç°åœ¨è·¯ç”±ç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”å…·æœ‰æ›´å¥½çš„é”™è¯¯å¤„ç†èƒ½åŠ›ï¼
