# 数据同步功能说明

## 🚀 新增功能

### 1. 分组数据本地缓存

#### 功能特性
- **自动保存**：新建分组时自动保存到本地存储
- **数据持久化**：页面刷新后分组数据不丢失
- **实时同步**：分组配置和持仓数据实时同步

#### 实现细节
```javascript
// 保存分组配置到本地存储
const saveGroups = (newGroups) => {
  setGroups(newGroups);
  localStorage.setItem('portfolioGroups', JSON.stringify(newGroups));
};

// 初始化时加载分组配置
useEffect(() => {
  const savedGroups = localStorage.getItem('portfolioGroups');
  if (savedGroups) {
    setGroups(JSON.parse(savedGroups));
  }
}, []);
```

### 2. 数据导出功能

#### 功能特性
- **完整导出**：导出所有分组和持仓数据
- **JSON格式**：标准JSON格式，便于处理
- **时间戳**：包含导出时间，便于版本管理
- **自动下载**：点击导出自动下载文件

#### 导出数据结构
```json
{
  "groups": {
    "短线": {
      "name": "短线",
      "description": "短期交易分组",
      "timeframe": "daily",
      "indicators": [],
      "showRating": true
    }
  },
  "holdings": {
    "短线": [
      {
        "code": "000001",
        "name": "平安银行",
        "price": 12.50,
        "change": 2.5,
        "market": "深圳主板",
        "addedTime": "2024-01-01 10:00:00",
        "rating": "buy",
        "lastAnalysis": {...}
      }
    ]
  },
  "exportTime": "2024-01-01T10:00:00.000Z",
  "version": "1.0"
}
```

#### 使用方式
1. 点击"导出数据"按钮
2. 系统自动生成JSON文件
3. 文件自动下载到本地
4. 文件名格式：`portfolio_data_YYYY-MM-DD.json`

### 3. 数据导入功能

#### 功能特性
- **数据合并**：导入数据与现有数据合并，不覆盖
- **格式验证**：自动验证JSON格式正确性
- **错误处理**：提供详细的错误提示
- **安全导入**：不会覆盖现有分组，只会添加新数据

#### 导入流程
1. 点击"导入数据"按钮
2. 在弹窗中粘贴导出的JSON数据
3. 点击"导入"按钮
4. 系统验证数据格式
5. 合并数据到本地存储
6. 刷新界面显示新数据

#### 错误处理
- **格式错误**：JSON格式不正确时提示错误
- **数据缺失**：缺少必要字段时提示错误
- **合并冲突**：同名分组会合并数据

## 🔧 技术实现

### 1. 本地存储策略
```javascript
// 分组配置存储
localStorage.setItem('portfolioGroups', JSON.stringify(groups));

// 持仓数据存储
localStorage.setItem('portfolioHoldings', JSON.stringify(holdings));
```

### 2. 数据导出实现
```javascript
const handleExportData = () => {
  const exportData = {
    groups: groups,
    holdings: holdings,
    exportTime: new Date().toISOString(),
    version: '1.0'
  };

  const dataStr = JSON.stringify(exportData, null, 2);
  const dataBlob = new Blob([dataStr], { type: 'application/json' });
  const url = URL.createObjectURL(dataBlob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = `portfolio_data_${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
};
```

### 3. 数据导入实现
```javascript
const handleImportData = () => {
  try {
    const importedData = JSON.parse(importData);
    
    if (!importedData.groups || !importedData.holdings) {
      message.error('数据格式不正确');
      return;
    }

    // 合并数据（保留现有数据，添加新数据）
    const newGroups = { ...groups, ...importedData.groups };
    const newHoldings = { ...holdings, ...importedData.holdings };

    setGroups(newGroups);
    setHoldings(newHoldings);
    saveGroups(newGroups);
    saveHoldings(newHoldings);
    
    message.success('数据导入成功');
  } catch (error) {
    message.error('数据格式错误，请检查JSON格式');
  }
};
```

## 📱 使用场景

### 1. 多设备同步
- **工作电脑**：导出数据文件
- **家庭电脑**：导入数据文件
- **移动设备**：通过云存储同步

### 2. 数据备份
- **定期备份**：定期导出数据作为备份
- **版本管理**：不同时间点的数据版本
- **灾难恢复**：数据丢失时快速恢复

### 3. 团队协作
- **数据共享**：团队成员间共享分组配置
- **策略同步**：统一的技术分析策略
- **经验传承**：资深用户的配置分享

## 🎯 优势特性

### 1. 数据安全
- **本地存储**：数据存储在本地，隐私安全
- **格式标准**：使用标准JSON格式，兼容性好
- **版本控制**：支持数据版本管理

### 2. 操作便捷
- **一键导出**：点击按钮即可导出
- **自动下载**：无需手动保存文件
- **格式验证**：自动验证数据格式

### 3. 扩展性强
- **模块化设计**：功能独立，易于扩展
- **标准格式**：便于与其他系统集成
- **版本兼容**：支持未来版本升级

## 🚀 后续优化

### 1. 云同步
- **自动同步**：支持云存储自动同步
- **实时更新**：多设备间实时数据同步
- **冲突解决**：智能处理数据冲突

### 2. 数据加密
- **数据加密**：敏感数据加密存储
- **权限控制**：不同用户权限管理
- **安全传输**：数据传输加密

### 3. 批量操作
- **批量导入**：支持多个文件批量导入
- **选择性导入**：选择特定分组导入
- **数据清理**：导入前数据清理功能

现在您的应用支持完整的数据同步功能，可以在不同设备间轻松同步分组和持仓数据！
